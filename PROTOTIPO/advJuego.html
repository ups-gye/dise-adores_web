<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¡SALTOS DE CIENCIAS!</title>
    <style>
        body {
            font-family: 'Comic Sans MS', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            text-align: center;
        }
        #gameContainer {
            background-image: url('img/fond.jpg');
            background-size: cover;
            width: 800px;
            height: 600px;
            margin: 20px auto;
            position: relative;
            border: 2px solid #000;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3);
        }
        #questionContainer, #boy, #cat, #stones, #lives, #progress, #jumpButton {
            display: none; /* Ocultamos todo hasta que se inicie el juego */
        }
        #startButton {
            position: absolute;
            top: 20px; /* Mover el botón a la parte superior */
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px;
            background-color: #28a745;
            color: #fff;
            font-size: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
        }
        #startButton:hover {
            background-color: #218838;
        }
        .option {
            display: inline-block;
            background-color: #007bff;
            color: #fff;
            padding: 10px 20px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .option:hover {
            background-color: #0056b3;
        }
        #lives {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 24px;
        }
        #progress {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
            color: #333;
        }
        #boy {
            position: absolute;
            bottom: 60px;
            left: 40px;
            width: 100px;
        }
        #cat {
            position: absolute;
            bottom: 80px;
            right: 100px;
            width: 100px;
            animation: bounce 2s infinite;
        }
        #stones {
            position: absolute;
            bottom: 20px; /* Bajamos las piedras un poco más hacia la parte inferior */
            left: 180px; /* Ajustamos para centrar mejor las piedras */
            width: 440px; /* Reducimos el espacio entre las piedras */
            height: 80px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            z-index: 1;
        }
        .stone {
            width: 60px;
            height: 60px;
            background-image: url('img/piedra.webp');
            background-size: cover;
            border-radius: 50%;
            position: absolute;
        }
        .stone:nth-child(1) {
            left: 0px;
            bottom: 10px; /* Bajamos un poco más cada piedra */
        }
        .stone:nth-child(2) {
            left: 90px; /* Acercamos las piedras */
            bottom: 30px;
        }
        .stone:nth-child(3) {
            left: 180px;
            bottom: 10px;
        }
        .stone:nth-child(4) {
            left: 270px;
            bottom: 30px;
        }
        .stone:nth-child(5) {
            left: 360px;
            bottom: 10px;
        }

        #jumpButton {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            font-size: 18px;
        }
        #jumpButton:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* Estilos para la ventana modal */
        #retryModal {
            display: none; /* Oculto por defecto */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7); /* Fondo semi-transparente */
            justify-content: center;
            align-items: center;
        }

        #retryModalContent {
            background-color: #fff;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.5s ease-out; /* Animación de entrada */
        }

        #retryModalContent h2 {
            font-size: 24px;
            color: #333;
        }

        #retryButton {
            background-color: #dc3545;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 18px;
            transition: background-color 0.3s ease;
        }

        #retryButton:hover {
            background-color: #c82333;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .lives-animation {
            animation: blink 0.3s alternate infinite;
        }

        @keyframes blink {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="lives">❤️❤️❤️</div>
        <div id="progress">Pregunta 1 de 5</div>
        <div id="questionContainer">
            <div id="question">Pregunta 1: ¿Cuál es la capital de Francia?</div>
            <div class="option" onclick="checkAnswer(0)">Madrid</div>
            <div class="option" onclick="checkAnswer(1)">París</div>
            <div class="option" onclick="checkAnswer(0)">Berlín</div>
        </div>
        <img id="boy" src="img/niño.png" alt="Niño">
        <img id="cat" src="img/gat.webp" alt="Gato">
        <div id="stones">
            <div class="stone"></div>
            <div class="stone"></div>
            <div class="stone"></div>
            <div class="stone"></div>
            <div class="stone"></div>
        </div>
        <button id="jumpButton" onclick="jump()">Saltar</button>
        <button id="startButton" onclick="startGame()">Iniciar el Juego</button> <!-- Botón para iniciar el juego -->
    </div>

    <div id="retryModal">
        <div id="retryModalContent">
            <h2>¡Has perdido todas tus vidas!</h2>
            <p>¿Quieres volver a intentarlo?</p>
            <button id="retryButton" onclick="resetGame()">Intentar de nuevo</button>
        </div>
    </div>

    <audio id="backgroundMusic" src="audio/angry-birds-videojuegos-.mp3" loop></audio> <!-- Aquí añades el sonido de fondo -->

    <script>
        let currentQuestion = 0;
        let lives = 3;
        let position = 0;

        const questions = [
            { question: "¿Cuál es la capital de Francia?", options: ["Madrid", "París", "Berlín"], correct: 1 },
            { question: "¿Cuál es la fórmula del agua?", options: ["CO2", "NaCl", "H2O"], correct: 2 },
            { question: "¿Cuántos planetas hay en el sistema solar?", options: ["8", "9", "10"], correct: 0 },
            { question: "¿Qué gas respiramos principalmente?", options: ["Oxígeno", "Hidrógeno", "Dióxido de carbono"], correct: 0 },
            { question: "¿Cuál es el metal más ligero?", options: ["Litio", "Mercurio", "Oro"], correct: 0 }
        ];

        function startGame() {
            // Reproducir música de fondo
            const audio = document.getElementById('backgroundMusic');
            audio.play().catch(error => {
                console.log("El navegador bloqueó la reproducción automática de audio.");
            });

            // Mostrar todos los elementos del juego
            document.getElementById('startButton').style.display = 'none'; // Oculta el botón de inicio
            document.getElementById('questionContainer').style.display = 'block';
            document.getElementById('boy').style.display = 'block';
            document.getElementById('cat').style.display = 'block';
            document.getElementById('stones').style.display = 'flex';
            document.getElementById('lives').style.display = 'block';
            document.getElementById('progress').style.display = 'block';

            // Cargar la primera pregunta
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion < questions.length) {
                const q = questions[currentQuestion];
                document.getElementById('question').innerText = q.question;
                const options = document.querySelectorAll('.option');
                for (let i = 0; i < options.length; i++) {
                    options[i].innerText = q.options[i];
                    options[i].onclick = () => checkAnswer(i);
                }
                document.getElementById('jumpButton').style.display = 'none'; // Oculta el botón al cargar una nueva pregunta
                document.getElementById('progress').innerText = `Pregunta ${currentQuestion + 1} de ${questions.length}`;
            } else {
                alert("¡Felicidades, cruzaste el río y te reencontraste con el gato!");
                showVictoryAnimation();
            }
        }

        function checkAnswer(selected) {
            if (selected === questions[currentQuestion].correct) {
                document.getElementById('jumpButton').style.display = 'block'; // Muestra el botón cuando la respuesta es correcta
            } else {
                lives--;
                updateLives();
                if (lives === 0) {
                    showRetryModal(); // Mostrar ventana modal en lugar de alerta
                } else {
                    alert("Respuesta incorrecta. Vuelve a intentarlo.");
                }
            }
        }

        function jump() {
            position++;
            const stones = document.querySelectorAll('.stone');

            if (position <= stones.length) {
                const targetStone = stones[position - 1];
                const stoneLeft = targetStone.offsetLeft;
                const stoneBottom = targetStone.offsetTop;

                const startX = document.getElementById('boy').offsetLeft;
                const startY = document.getElementById('boy').offsetTop;
                const endX = stoneLeft + (targetStone.offsetWidth / 2) - (document.getElementById('boy').offsetWidth / 2);
                const endY = stoneBottom;

                animateJump(startX, startY, endX, endY, 500);

                setTimeout(() => {
                    document.getElementById('jumpButton').style.display = 'none'; // Oculta el botón de nuevo hasta la siguiente pregunta correcta
                    currentQuestion++;
                    loadQuestion();
                }, 600);
            }

            if (position === stones.length) {
                // El niño ha llegado al final
                setTimeout(() => {
                    alert("¡Felicidades, cruzaste el río y te reencontraste con el gato!");
                    showVictoryAnimation();
                }, 500);
            }
        }

        function animateJump(startX, startY, endX, endY, duration) {
            const element = document.getElementById('boy');
            const frameRate = 60;
            const totalFrames = Math.round((duration / 1000) * frameRate);
            let currentFrame = 0;

            const interval = setInterval(() => {
                currentFrame++;
                const progress = currentFrame / totalFrames;
                const x = startX + (endX - startX) * progress;
                const y = startY + (endY - startY) * progress;

                element.style.left = `${x}px`;
                element.style.top = `${y}px`;

                if (currentFrame >= totalFrames) {
                    clearInterval(interval);
                }
            }, 1000 / frameRate);
        }

        function updateLives() {
            const livesContainer = document.getElementById('lives');
            livesContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                livesContainer.innerHTML += '❤️';
            }
            if (lives > 0 && lives < 3) {
                livesContainer.classList.add('lives-animation');
                setTimeout(() => livesContainer.classList.remove('lives-animation'), 1000);
            }
        }

        function showRetryModal() {
            document.getElementById('retryModal').style.display = 'flex'; // Mostrar la ventana modal
        }

        function showVictoryAnimation() {
            document.getElementById('boy').style.left = '660px';
            document.getElementById('boy').style.bottom = '80px';
            setTimeout(() => {
                alert("¡Felicidades! ¡Has ganado el juego!");
                resetGame();
            }, 1000);
        }

        function resetGame() {
            document.getElementById('retryModal').style.display = 'none'; // Oculta la ventana modal
            currentQuestion = 0;
            lives = 3;
            position = 0;
            document.getElementById('boy').style.left = '40px';
            document.getElementById('boy').style.bottom = '60px';
            updateLives();
            loadQuestion();
        }
    </script>
</body>
</html>
